name: Build & Deploy app

on:
  pull_request_target:
    types:
    - closed

jobs:
  build:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: Build
      uses: adrielcodeco/docker-compose-run-action@v1
      with:
        compose-file: './docker-compose.ci.yml'
        service: tester
        command: 'go build -v -o telegram-quiz-bot ./cmd/quizbot'
    
    - name: Upload artifacts
      uses: actions/upload-artifact@v3
      with:
        name: telegram-quiz-bot
        path: bot/app/telegram-quiz-bot

  deploy:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    needs: [build]
    steps:
    - name: Download artifacts
      uses: actions/download-artifact@v3
      with:
        name: telegram-quiz-bot
    - name: Copy Go App to server
      run: echo "TODO"
